package myapp;

import java.io.File;
import java.io.IOException;
import java.util.HashMap;

import com.fasterxml.jackson.core.JsonGenerationException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;

public class Requests {
	private String nfich;
	private HashMap<String,String> pendingRequests;

	
	public Requests() {
		super();
		this.pendingRequests = new HashMap<String,String>();
	}
	
	public Requests(String nfich) {
		super();
		this.nfich = nfich;
		this.pendingRequests = new HashMap<String,String>();
	}

	public HashMap<String, String> getPendingRequests() {
		return pendingRequests;
	}

	public void setPendingRequests(HashMap<String, String> pendingRequests) {
		this.pendingRequests = pendingRequests;
	}
	private void saveStatus() throws JsonGenerationException, JsonMappingException, IOException{
		ObjectMapper om = new ObjectMapper();
		om.writeValue(new File(nfich), this.pendingRequests);
	}
	@SuppressWarnings("unchecked")
	public synchronized void backupRequests() throws IOException{
		File fich = new File(nfich);
		if(fich.exists()){
			ObjectMapper om = new ObjectMapper();
			pendingRequests = om.readValue(fich, HashMap.class);
		}
	}
	
	public synchronized void putRequest(String dominio, String regId) throws JsonGenerationException, JsonMappingException, IOException{
		this.pendingRequests.put(dominio, regId);
		saveStatus();
	}
	
	public synchronized String getRequest(String dominio) throws JsonGenerationException, JsonMappingException, IOException{
		String regId = this.pendingRequests.get(dominio);
		this.pendingRequests.remove(dominio);
		saveStatus();
		return regId;
	}
}
